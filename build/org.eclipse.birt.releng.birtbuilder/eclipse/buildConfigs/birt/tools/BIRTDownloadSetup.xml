<?xml version="1.0" encoding="ASCII" ?>
<!-- ************************************************************************* 
	* Copyright (c) 2004, 2005 Actuate Corporation. * All rights reserved. This 
	program and the accompanying materials * are made available under the terms 
	of the Eclipse Public License v2.0.0 * which accompanies this distribution, 
	and is available at * http://www.eclipse.org/legal/epl-v10.html * * Contributors: 
	* Actuate Corporation - initial API and implementation * ************************************************************************* 
	* * EclipseDownloadSetup.xml * * Created on 04/11/2005 * Create package file 
	(zip) for download.eclipse.org. * * * The following are public targets callable 
	by external users. * * default create and upload the packages. * DownLoadSetup 
	create the packages. * upload2eclipse.org upload the packages. * Usage: * 
	ant [any one or more of the public targets] * - -file EclipseDownloadSetup.xml 
	* -logfile adb.log * * * Notes: * * Change History: * * 1. 05/16/2005: initial 
	version * * -->

<project name="EclipseDownloadSetup For BIRT Release 2.3"
	default="default" basedir=".">



	<tstamp prefix="timestamp">
		<format property="TODAY_MIN" pattern="yyyyMMddHHMM" />
		<format property="TODAY" pattern="yyyyMMdd" />
	</tstamp>


	<!--Define the build type -->
	<property name="checkout.version" value="" />
	<property name="BuildType" value="Nightly" />
	<property name="NightlyBuild" value="N" />
	<property name="StableBuild" value="S" />
	<property name="RCBuild" value="S" />

	<property name="birt.info" value="build_info.txt" />

	<!--Property for Zip file prefix -->
	<property name="ZipPrefix" value="eclipse/plugins" />
	<property name="FeautrePrefix" value="eclipse/features" />


	<property name="viewer.version"
		value="${org.eclipse.birt.report.viewer.plugin.version}" />
	<property name="package.version" value="2_3_0" />
	<property name="sdk.zip.name"
		value="birt-report-framework-sdk-${package.version}.zip" />
	<property name="framework.zip.name" value="birt-report-framework-${package.version}.zip" />
	<property name="allinone.zip.name"
		value="birt-report-designer-all-in-one-${package.version}.zip" />
	<property name="allinone_64.zip.name"
			value="birt-report-designer-all-in-one-x86_64-${package.version}.zip" />
	<property name="allinone.hq.zip.name"
		value="birt-report-designer-all-in-one-HQ-${package.version}.zip" />
	<property name="allinone.linux.zip.name"
		value="birt-report-designer-all-in-one-${package.version}-linux-gtk.tar" />
	<property name="allinone.mac.zip.name"
		value="birt-report-designer-all-in-one-${package.version}-macosx-cocoa-x86_64.tar.gz" />
	<property name="runtime.zip.name" value="birt-runtime-${package.version}.zip" />
	<property name="runtime.osgi.zip.name" value="birt-runtime-osgi-${package.version}.zip" />
	<property name="wtp.runtime.zip.name" value="birt.zip" />
	<property name="iportal.lib.name" value="iportal-library.zip" />
	<property name="wtp.integration.zip.name"
		value="birt-wtp-integration-sdk-${package.version}.zip" />

	<property name="runtime.tmp" value="${OutputDir}/runtime_tmp" />
	<property name="war.tmp" value="${OutputDir}/war_tmp" />
	<property name="package.files.dir" value="${baseLocation}/../PackageFiles" />
	<property name="template.dir" value="${package.files.dir}/template" />
	<property name="all.in.one.file.dir" value="${package.files.dir}/AllInOne" />
	<property name="RCP.static.file.dir" value="${package.files.dir}/RCP" />

	<property name="iportal.tmp" value="${OutputDir}/iportal_tmp" />

	<property name="birt.runtime.dir.prefix" value="birt-runtime-${package.version}" />
	<property name="birt.runtime.osgi.dir.prefix" value="birt-runtime-osgi-${package.version}" />
	<property name="birt.rcp.dir.prefix" value="birt-rcp-report-designer-${package.version}" />

	<property name="birt.rcp.zip.name" value="birt-rcp-report-designer-${package.version}" />
	<property name="sample.plugin.zip.name" value="birt-sample-plugins-${package.version}.zip" />
	<property name="birt.dtp.integration.name" value="birt-dtp-integration-${package.version}.zip" />

	<!--Define the engine runtime plugins -->
	<patternset id="engine.runtime.plugins">
		<include name="org.eclipse.birt.report.data.oda.jdbc*.jar" />
		<include name="org.eclipse.birt.report.data.oda.sampledb*.jar" />
		<include name="org.eclipse.birt.report.engine.emitter.pdf*.jar" />
		<include name="org.eclipse.birt.report.engine.emitter.html*.jar" />
	</patternset>

	<!--Define the engine runtime file set -->
	<patternset id="engine.runtime.jars">
		<include name="org.eclipse.birt.report.engine*/engine.jar" />
		<include name="org.eclipse.birt.data.oda*/oda.jar" />
		<include name="org.eclipse.birt.data*/dte.jar" />
		<include name="org.eclipse.birt.core*/core.jar" />
		<include name="org.eclipse.birt.report.model*/model.jar" />
	</patternset>

	<!-- obsolete feature list -->
	<patternset id="third.party.features">
		<exclude name="com.itextpdf.text_*/**" />
		<exclude name="org.apache.poi*/**" />
		<exclude name="org.apache.commons.codec_*/**" />
		<exclude name="org.w3c.sac_*/**" />
		<exclude name="org.mozilla.javascript*/**" />
		<exclude name="org.apache.derby.core_*/**" />
		<exclude name="org.eclipse.birt.crosstab*/**" />
		<exclude name="org.eclipse.birt.report.data.oda.jdbc*/**" />
		<exclude name="org.eclipse.birt.report.designer_*/**" />
		<exclude name="org.eclipse.birt.report.designer.debug*/**" />
		<exclude name="org.eclipse.birt.report.runtime*/**" />
	</patternset>

	<!-- Define the Orbit project jars -->
	<patternset id="orbit.include.jars">
		<include name="org.apache.batik.*jar" />
		<include name="org.w3c.dom.svg_*.jar" />
		<include name="org.w3c.dom.smil_*.jar" />
		<include name="org.w3c.css.sac_*.jar" />
		<include name="org.apache.axis_*/**" />
		<include name="javax.xml.rpc_*/**" />
		<include name="javax.xml.soap_*/**" />
		<include name="javax.wsdl_1.5.1*.jar" />
		<include name="org.apache.commons.discovery_*/**" />
	</patternset>

	<!--Exclude jar file pattern set -->

	<patternset id="exclude.jars">
		<exclude name="**/jtds-0.9.jar" />
		<exclude name="**/db2jcc.jar" />
		<exclude name="**/db2jcc_license_c.jar" />
		<exclude name="**/db2jcc_license_cu.jar" />
		<exclude name="**/ifxjdbc.jar" />
		<exclude name="**/jtds-0.9.jar" />
		<exclude name="**/mysql-connector-java-3.0.16-ga-bin.jar" />
		<exclude name="**/ojdbc14.jar" />
		<exclude name="**/postgresql-8.0-310.jdbc3.jar" />
		<exclude name="**/JimiProClasses.zip" />
		<exclude name="**/org.eclipse.birt.data*/**/castor-0.9.5.4-xml.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/derbynet.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/js.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/osgi.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/runtime.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/xercesImpl.jar" />
		<exclude name="**/org.eclipse.birt.data*/**/xml-apis.jar" />
		<exclude name="**/junit.jar" />
		<exclude name="**/hsqldb.jar" />
		<exclude name="**/common.jar" />
		<exclude name="**/common.resources.jar" />
		<exclude
			name="**/org.eclipse.datatools.connectivity.oda*/lib/birt-core.jar" />
	</patternset>

	<target name="default">
		<antcall target="DownLoadSetup" />
	</target>

	<!-- Set up download pages -->
	<target name="DownLoadSetup">

		<echo message="DownloadPage Setup starts at ${timestamp.TODAY_MIN}" />
		<echo message="Copy log files to deposit" />

		<copy file="${template.dir}\build_info_template_new.txt" tofile="${OutputDir}\${birt.info}"
			overwrite="true" failonerror="false" />

		<antcall target="createBirtFramework" />

		<antcall target="createBirtSDK" />

		<antcall target="createBirtRuntime" />

		<antcall target="createBirtRuntime_OSGI" />

		<antcall target="createSamplePlugin" />

		<antcall target="createBirtRCP" />

		<antcall target="createDatabase" />

		<antcall target="createAllInOne" />
		
		<antcall target="createAllInOne_64" />

		<antcall target="createAllInOneForLinux" />
		
		<antcall target="createAllInOneForMac" />

		<antcall target="createBirtSourceBuild" />

		<property file="${builder.dir}/dtpURLmonitor.properties" />
		<property file="${eclipse.build.configs}/../../config.properties" />
		<replace file="${OutputDir}\${birt.info}" token="#buildType#"
			value="Nightly" />
		<replace file="${OutputDir}\${birt.info}" token="#timeStamp#"
			value="${buildId}" />
		<replace file="${OutputDir}\${birt.info}" token="#branch#"
			value="${package.version}" />
		<replace file="${OutputDir}\${birt.info}" token="#buildVersion#"
			value="${BranchVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#ECLIPSEVERSION#"
			value="${eclipseVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#ECLIPSEURL#"
			value="${eclipseURL}" />
		<replace file="${OutputDir}\${birt.info}" token="#EMFVERSION#"
			value="${emfVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#EMFURL#"
			value="${emfURL}" />
		<replace file="${OutputDir}\${birt.info}" token="#GEFVERSION#"
			value="${gefVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#GEFURL#"
			value="${gefURL}" />
		<replace file="${OutputDir}\${birt.info}" token="#DTPVERSION#"
			value="${dtpVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#DTPURL#"
			value="${dtpURL}" />
		<replace file="${OutputDir}\${birt.info}" token="#WTPVERSION#"
			value="${wtpVersion}" />
		<replace file="${OutputDir}\${birt.info}" token="#WTPURL#"
			value="${wtpURL}" />

		<exec executable="git" dir="${buildDirectory}/scmCache/${BirtRepoCache}"
			outputproperty="lastcommitid">
			<arg line="log ${mapVersionTag} -1 --pretty=format:%H" />
		</exec>
		<replace file="${OutputDir}\${birt.info}" token="#lastcommitid#"
			value="${lastcommitid}" />
		<echo message="${lastcommitid}" file="${builder.dir}/lastchangelist"/>

	</target>

	<target name="createBirtSDK">
		<!-- Make BIRT SDK ZIP file -->
		<zip destfile="${OutputDir}/${sdk.zip.name}" duplicate="preserve">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="**/*" />
				<exclude name="**/org.eclipse.birt.sample.reportitem.rotatedtext*.jar" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
			<zipfileset dir="${deposit}/eclipse/features" prefix="${FeautrePrefix}">
				<include name="**/*" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
			</zipfileset>
			<zipfileset dir="${buildDirectory}/plugins" prefix="${ZipPrefix}">
				<patternset refid="orbit.include.jars" />
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="eclipse">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
		</zip>
	</target>

	<target name="createBirtFramework">
		<!-- Make birt framework ZIP file -->
		<!-- Exclude SDK feature and corresponding plug-ins -->

		<zip destfile="${OutputDir}/${framework.zip.name}" duplicate="preserve">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="**/*" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.rcp*/**" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.sample.reportitem.rotatedtext*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.report.viewer_*/birt/ajax/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
			<zipfileset dir="${deposit}/eclipse/features" prefix="${FeautrePrefix}">
				<include name="**/*" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="org.eclipse.birt*source*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
			</zipfileset>
			<zipfileset dir="${buildDirectory}/plugins" prefix="${ZipPrefix}">
				<patternset refid="orbit.include.jars" />
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="eclipse">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
		</zip>
	</target>

	<target name="createIpotalLib">
		<property file="${buildDirectory}/finalPluginsVersions.properties" />
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.core.contenttype_.*.jar"
				to="org.eclipse.core.contenttype.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.core.jobs_.*.jar" to="org.eclipse.core.jobs.jar" />
		</copy>	
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.core.runtime_.*.jar"
				to="org.eclipse.core.runtime.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp"
				from="org.eclipse.datatools.connectivity.oda.design_.*.jar" to="org.eclipse.datatools.connectivity.oda.design.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.datatools.connectivity.oda_.*.jar"
				to="org.eclipse.datatools.connectivity.oda.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.emf_.*.jar" to="org.eclipse.emf.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.equinox.common_.*.jar"
				to="org.eclipse.equinox.common.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.equinox.preferences_.*.jar"
				to="org.eclipse.equinox.preferences.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.equinox.registry_.*.jar"
				to="org.eclipse.equinox.registry.jar" />
		</copy>
		<copy todir="${iportal.tmp}">
			<fileset dir="${baseLocation}/plugins" />
			<mapper type="regexp" from="org.eclipse.osgi_.*.jar" to="org.eclipse.osgi.jar" />
		</copy>
		<copy tofile="${iportal.tmp}/org.eclipse.birt.report.model.adapter.oda.jar"
			file="${deposit}/eclipse/plugins/org.eclipse.birt.report.model.adapter.oda_${org.eclipse.birt.report.model.adapter.oda}.jar" />
		<zip destfile="${OutputDir}/${iportal.lib.name}">
			<zipfileset dir="${iportal.tmp}">
				<include name="**/*" />
			</zipfileset>
		</zip>
		<delete dir="${iportal.tmp}" />
	</target>

	<target name="createAllInOne">
		<!-- Make birt all-in-one ZIP file -->
		<zip destfile="${OutputDir}/${allinone.zip.name}" duplicate="preserve">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="**/*" />
				<exclude name="org.eclipse.birt.report.designer.ui.rcp*/**" />
				<exclude name="org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
				<exclude name="org.eclipse.birt.sample.reportitem.rotatedtext*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.integration.wtp.ui*/**" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk_*.jar" />
				<exclude name="org.eclipse.birt.report.designer_*/**" />
				<exclude name="org.eclipse.birt.report.runtime_*/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
			<zipfileset dir="${deposit}/eclipse/features" prefix="${FeautrePrefix}">
				<include name="**/*" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="org.eclipse.birt.*.sdk*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
				<patternset refid="third.party.features" />
			</zipfileset>
			<!-- <zipfileset dir="${template.dir}/legal" prefix="eclipse"> <include 
				name="**/*" /> </zipfileset> -->
			<zipfileset dir="${package.files.dir}/jee" includes="**/*" />
			<!--zipfileset
				file="${eclipse.build.configs}/../../extras/eclipse.exe.manifest"
				prefix="eclipse" /-->
			<zipfileset dir="${buildDirectory}/plugins" prefix="${ZipPrefix}">
				<patternset refid="orbit.include.jars" />
			</zipfileset>
		</zip>

		<antcall target="RepackageAllinone" />

	</target>

	<target name="createAllInOne_64">
		<!-- Make birt all-in-one ZIP file -->
		<zip destfile="${OutputDir}/${allinone_64.zip.name}" duplicate="preserve">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="**/*" />
				<exclude name="org.eclipse.birt.report.designer.ui.rcp*/**" />
				<exclude name="org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
				<exclude name="org.eclipse.birt.sample.reportitem.rotatedtext*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.integration.wtp.ui*/**" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk_*.jar" />
				<exclude name="org.eclipse.birt.report.designer_*/**" />
				<exclude name="org.eclipse.birt.report.runtime_*/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
			<zipfileset dir="${deposit}/eclipse/features" prefix="${FeautrePrefix}">
				<include name="**/*" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="org.eclipse.birt.*.sdk*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
				<patternset refid="third.party.features" />
			</zipfileset>
			<!-- <zipfileset dir="${template.dir}/legal" prefix="eclipse"> <include 
				name="**/*" /> </zipfileset> -->
			<zipfileset dir="${package.files.dir}/jee-x86_64" includes="**/*" />
			<!--zipfileset
				file="${eclipse.build.configs}/../../extras/eclipse.exe.manifest"
				prefix="eclipse" /-->
			<zipfileset dir="${buildDirectory}/plugins" prefix="${ZipPrefix}">
				<patternset refid="orbit.include.jars" />
			</zipfileset>
		</zip>

		<antcall target="RepackageAllinone_64" />

	</target>
	
	<target name="RepackageAllinone" if="repackage.allinone">
		<!-- repackage allinone for HQ,refer TED 34798 -->
		<delete dir="${OutputDir}/tmp" failonerror="false" />
		<unzip src="${OutputDir}/${allinone.zip.name}" dest="${OutputDir}/tmp" />
		<delete file="${OutputDir}/${allinone.zip.name}" />
		<zip destfile="${OutputDir}/${allinone.zip.name}">
			<fileset dir="${OutputDir}/tmp">
				<include name="eclipse/**" />
			</fileset>
		</zip>
		<delete dir="${OutputDir}/tmp" />
	</target>

	<target name="RepackageAllinone_64" if="repackage.allinone">
		<!-- repackage allinone for HQ,refer TED 34798 -->
		<delete dir="${OutputDir}/tmp" failonerror="false" />
		<unzip src="${OutputDir}/${allinone_64.zip.name}" dest="${OutputDir}/tmp" />
		<delete file="${OutputDir}/${allinone_64.zip.name}" />
		<zip destfile="${OutputDir}/${allinone_64.zip.name}">
			<fileset dir="${OutputDir}/tmp">
				<include name="eclipse/**" />
			</fileset>
		</zip>
		<delete dir="${OutputDir}/tmp" />
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - This 
		target is used for create All-In-One package for Linux - - - - - - - - - 
		- - - - - - - - - - - - - - - - - - - - - - - - - -->
	<target name="createAllInOneForLinux" unless="skip.allinone.linux">
		<!-- Make birt all-in-one ZIP file -->
		<mkdir dir="${OutputDir}/temp" />
		<mkdir dir="${OutputDir}/temp/eclipse" />
		<mkdir dir="${OutputDir}/temp/eclipse/plugins" />
		<mkdir dir="${OutputDir}/temp/eclipse/features" />

		<copy todir="${OutputDir}/temp/eclipse/plugins" overwrite="true">
			<fileset dir="${deposit}/eclipse/plugins">
				<include name="**/*" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.rcp*/**" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
				<exclude name="org.eclipse.birt.sample.reportitem.rotatedtext*/**" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk_*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.integration.wtp.ui*/**" />
				<exclude name="org.eclipse.birt.report.designer_*/**" />
				<exclude name="org.eclipse.birt.report.runtime_*/**" />
				<patternset refid="exclude.jars" />
			</fileset>
			<fileset dir="${buildDirectory}/plugins">
				<patternset refid="orbit.include.jars" />
			</fileset>
		</copy>
		<copy todir="${OutputDir}/temp/eclipse/features" overwrite="true">
			<fileset dir="${deposit}/eclipse/features">
				<include name="**/*" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="org.eclipse.birt.*.sdk*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
				<patternset refid="third.party.features" />
			</fileset>
		</copy>
		<copy todir="${OutputDir}/temp/eclipse" overwrite="true">
			<fileset dir="${package.files.dir}/jee-linux/eclipse"
				includes="**/*" />
		</copy>
		<exec executable="chmod" dir="${OutputDir}/temp/eclipse">
			<arg line="+x eclipse" />
		</exec>
		<exec executable="tar" dir="${OutputDir}/temp">
			<arg line="-cvf ${OutputDir}/${allinone.linux.zip.name} eclipse/" />
		</exec>

		<exec executable="gzip" dir="${OutputDir}">
			<arg line="${OutputDir}/${allinone.linux.zip.name}" />
		</exec>

		<delete dir="${OutputDir}/temp" includeemptydirs="true" />

	</target>

	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - This 
		target is used for create All-In-One package for Mac - - - - - - - - - 
		- - - - - - - - - - - - - - - - - - - - - - - - - -->
	<target name="createAllInOneForMac">
		<!-- Make birt all-in-one ZIP file -->
		<mkdir dir="${OutputDir}/temp" />
		<mkdir dir="${OutputDir}/temp/eclipse" />
		<mkdir dir="${OutputDir}/temp/eclipse/plugins" />
		<mkdir dir="${OutputDir}/temp/eclipse/features" />

		<copy todir="${OutputDir}/temp/eclipse/plugins" overwrite="true">
			<fileset dir="${deposit}/eclipse/plugins">
				<include name="**/*" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.rcp*/**" />
				<exclude name="**/org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
				<exclude name="org.eclipse.birt.sample.reportitem.rotatedtext*/**" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk_*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.integration.wtp.ui*/**" />
				<exclude name="org.eclipse.birt.report.designer_*/**" />
				<exclude name="org.eclipse.birt.report.runtime_*/**" />
				<patternset refid="exclude.jars" />
			</fileset>
			<fileset dir="${buildDirectory}/plugins">
				<patternset refid="orbit.include.jars" />
			</fileset>
		</copy>
		<copy todir="${OutputDir}/temp/eclipse/features" overwrite="true">
			<fileset dir="${deposit}/eclipse/features">
				<include name="**/*" />
				<exclude name="*.source_*/**" />
				<exclude name="org.eclipse.birt.sdk*/**" />
				<exclude name="org.eclipse.birt.*.sdk*/**" />
				<exclude name="org.eclipse.birt.thirdparty*/**" />
				<exclude name="org.eclipse.birt.rcp*/**" />
				<exclude name="org.eclipse.birt.integration.wtp*/**" />
				<exclude name="org.eclipse.birt.osgi*/**" />
				<patternset refid="third.party.features" />
			</fileset>
		</copy>
		<copy todir="${OutputDir}/temp/eclipse" overwrite="true">
			<fileset dir="${package.files.dir}/jee-mac/eclipse"
				includes="**/*" />
		</copy>
		<exec executable="chmod" dir="${OutputDir}/temp/eclipse">
			<arg line="+x eclipse" />
		</exec>
		<exec executable="tar" dir="${OutputDir}/temp">
			<arg line="-czf ${OutputDir}/${allinone.mac.zip.name} eclipse/" />
		</exec>

		<delete dir="${OutputDir}/temp" includeemptydirs="true" />

		<antcall target="RepackageAllinone_mac" />
		
	</target>	
	
	<target name="RepackageAllinone_mac" if="repackage.allinone">
		<!-- repackage allinone for HQ,refer TED 34798 -->
		<delete dir="${OutputDir}/tmp" failonerror="false" />
		<untar src="${OutputDir}/${allinone.mac.zip.name}" dest="${OutputDir}/tmp" compression="gzip"/>
		
		<delete file="${OutputDir}/${allinone.mac.zip.name}" />
		<exec executable="chmod" dir="${OutputDir}/tmp/eclipse/Eclipse.app/Contents/MacOS">
			<arg line="+x eclipse" />
		</exec>
		<delete file="${OutputDir}/tmp/eclipse/eclipse" />
		<symlink link="${OutputDir}/tmp/eclipse/eclipse" 
		         resource="Eclipse.app/Contents/MacOS/eclipse"/>
		<exec executable="tar" dir="${OutputDir}/tmp">
			<arg line="-czf ${OutputDir}/${allinone.mac.zip.name} eclipse/" />
		</exec>

		<delete dir="${OutputDir}/tmp" />
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - This 
		target is used for create birt.zip for integration.wtp.ui - - - - - - - - 
		- - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<target name="createWebViewerExample">
		<copy todir="${runtime.tmp}">
			<fileset
				dir="${deposit}/birt_web/org.eclipse.birt.report.viewer/birt_web">
				<patternset refid="exclude.jars" />
				<exclude name="plugins/**" />
				<exclude name="images/**" />
				<exclude name="pages/**" />
				<exclude name="styles/**" />
				<exclude name="**/org.junit*/**" />
				<exclude name="WEB-INF/platform/**" />
			</fileset>
		</copy>

		<!--correct web.xml in birt sample, remove *_jsp.class from the viewservlets.jar -->
		<!--move file="${runtime.tmp}/WEB-INF/web_deploy.xml" tofile="${runtime.tmp}/WebViewerExample/WEB-INF/web.xml" 
			/ -->
		<unjar src="${runtime.tmp}/WEB-INF/lib/viewservlets.jar" dest="${runtime.tmp}/WEB-INF/lib/viewservlets" />
		<delete file="${runtime.tmp}/WEB-INF/lib/viewservlets.jar" />
		<jar destfile="${runtime.tmp}/WEB-INF/lib/viewservlets.jar"
			basedir="${runtime.tmp}/WEB-INF/lib/viewservlets" excludes="**/*_jsp.class" />
		<delete dir="${runtime.tmp}/WEB-INF/lib/viewservlets" />

		<copy todir="${runtime.tmp}">
			<fileset dir="${template.dir}/birt.runtime.files">
				<include name="*.*" />
			</fileset>
		</copy>

		<!-- delete unuse folders and files -->
		<delete dir="${runtime.tmp}/ajax" failonerror="false" />
		<delete dir="${runtime.tmp}/logs" failonerror="false" />
		<delete dir="${runtime.tmp}/report" failonerror="false" />
		<delete dir="${runtime.tmp}/scriptlib" failonerror="false" />
		<delete file="${runtime.tmp}/WEB-INF/web.xml" failonerror="false" />
		<delete file="${runtime.tmp}/WEB-INF/web-template.xml"
			failonerror="false" />
		<delete file="${runtime.tmp}/WEB-INF/web_deploy.xml"
			failonerror="false" />

		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${runtime.tmp}/WEB-INF/platform" includes="lib/**" />
		</delete>
		<zip destfile="${OutputDir}/${wtp.runtime.zip.name}">
			<zipfileset dir="${runtime.tmp}" />
		</zip>
		<delete dir="${runtime.tmp}" />
	</target>

	<target name="createBirtRuntime" depends="createGenReport,createWAR">
		<!-- Create birt-runtime/ReportEngine -->
		<copy todir="${runtime.tmp}/ReportEngine/lib" flatten="false">
			<fileset
				dir="${deposit}/birt_web/org.eclipse.birt.report.viewer/birt_web/WEB-INF/platform/lib">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy todir="${runtime.tmp}/ReportEngine/samples">
			<fileset dir="${template.dir}/engine.runtime.samples">
				<include name="*.*" />
			</fileset>
		</copy>
		<copy todir="${runtime.tmp}/ReportEngine">
			<fileset dir="${template.dir}/engine.runtime.bin">
				<include name="*.*" />
			</fileset>
		</copy>

		<!-- Create birt-runtime/WebViewerExample -->
		<copy todir="${runtime.tmp}/WebViewerExample">
			<fileset
				dir="${deposit}/birt_web/org.eclipse.birt.report.viewer/birt_web">
				<exclude name="WEB-INF/platform/**" />
				<patternset refid="exclude.jars" />
			</fileset>
		</copy>

		<!--Correct web.xml in birt sample, remove *_jsp.class from the viewservlets.jar -->
		<move file="${runtime.tmp}/WebViewerExample/WEB-INF/web_deploy.xml"
			tofile="${runtime.tmp}/WebViewerExample/WEB-INF/web.xml" />
		<unjar src="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar"
			dest="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets" />
		<delete file="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar" />
		<jar destfile="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar"
			basedir="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets"
			excludes="**/*_jsp.class" />
		<delete dir="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets" />

		<copy todir="${runtime.tmp}">
			<fileset dir="${template.dir}/birt.runtime.files">
				<include name="*.*" />
			</fileset>
		</copy>

		<delete dir="${runtime.tmp}/WebViewerExample/ajax" />

		<zip destfile="${OutputDir}/${runtime.zip.name}">
			<zipfileset dir="${runtime.tmp}" prefix="${birt.runtime.dir.prefix}"
				filemode="755">
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="${birt.runtime.dir.prefix}">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
			<zipfileset dir="${template.dir}/birt-runtime-about"
				prefix="${birt.runtime.dir.prefix}">
				<include name="**/*" />
			</zipfileset>
		</zip>

		<delete dir="${OutputDir}/runtime_nonosgi" failonerror="false" />
		<delete dir="${runtime.tmp}" failonerror="false" />

	</target>

	<target name="createBirtRuntime_OSGI" if="build.runtimeOSGI">

		<antcall target="createWAR_OSGI" />
		<!-- Create birt-runtime/ReportEngine -->
		<copy todir="${runtime.tmp}/ReportEngine" flatten="false">
			<fileset
				dir="${deposit}/birt_web_OSGI/org.eclipse.birt.report.viewer/birt_web_OSGI/WEB-INF/platform">
				<patternset refid="exclude.jars" />
				<exclude name="**/org.junit*/**" />
			</fileset>
		</copy>
		<copy todir="${runtime.tmp}/ReportEngine/samples">
			<fileset dir="${template.dir}/engine.runtime.samples">
				<include name="*.*" />
			</fileset>
		</copy>
		<copy todir="${runtime.tmp}/ReportEngine">
			<fileset dir="${template.dir}/engine.runtime.bin">
				<include name="*.*" />
			</fileset>
		</copy>

		<!-- Create birt-runtime/WebViewerExample -->
		<copy todir="${runtime.tmp}/WebViewerExample">
			<fileset
				dir="${deposit}/birt_web_OSGI/org.eclipse.birt.report.viewer/birt_web_OSGI">
				<patternset refid="exclude.jars" />
				<exclude name="plugins/**" />
				<exclude name="images/**" />
				<exclude name="pages/**" />
				<exclude name="styles/**" />
				<exclude name="**/org.junit*/**" />
				<exclude name="**/org.eclipse.birt.runtime_*.jar" />
			</fileset>
		</copy>

		<!--Correct web.xml in birt sample, remove *_jsp.class from the viewservlets.jar -->
		<move file="${runtime.tmp}/WebViewerExample/WEB-INF/web_deploy.xml"
			tofile="${runtime.tmp}/WebViewerExample/WEB-INF/web.xml" />
		<unjar src="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar"
			dest="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets" />
		<delete file="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar" />
		<jar destfile="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets.jar"
			basedir="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets"
			excludes="**/*_jsp.class" />
		<delete dir="${runtime.tmp}/WebViewerExample/WEB-INF/lib/viewservlets" />

		<copy todir="${runtime.tmp}">
			<fileset dir="${template.dir}/birt.runtime.files">
				<include name="*.*" />
			</fileset>
		</copy>

		<delete dir="${runtime.tmp}/WebViewerExample/ajax" />
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${runtime.tmp}/WebViewerExample/WEB-INF/platform"
				includes="lib/**" />
		</delete>

		<zip destfile="${OutputDir}/${runtime.osgi.zip.name}">
			<zipfileset dir="${runtime.tmp}" prefix="${birt.runtime.osgi.dir.prefix}"
				filemode="755">
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="${birt.runtime.osgi.dir.prefix}">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
			<zipfileset dir="${template.dir}/birt-runtime-about"
				prefix="${birt.runtime.osgi.dir.prefix}">
				<include name="**/*" />
			</zipfileset>
		</zip>
		<delete dir="${runtime.tmp}" />

	</target>

	<target name="createBirtRuntimeNonOSGi">

		<property file="${buildDirectory}/finalPluginsVersions.properties" />

		<!-- Unzip BirtRuntimeOSGi package to get birt and datatools jar -->
		<mkdir dir="${OutputDir}/runtime_nonosgi" />

		<unzip
			src="${postingDirectory}/${buildId}/birt-runtime-non-osgi-${package.version}.zip"
			dest="${OutputDir}/runtime_nonosgi" overwrite="true" />

		<delete
			file="${postingDirectory}/${buildId}/birt-runtime-non-osgi-${package.version}.zip"
			failonerror="false" />

	</target>

	<target name="createBirtRCP" unless="skip.build.rcp">
		<exec executable="unzip" dir="${OutputDir}/">
			<arg line="-o -q ${birt.rcp.zip.name}.zip -d ${OutputDir}" />
		</exec>

		<!-- <delete file="${OutputDir}/${birt.rcp.zip.name}.zip"/> <copy todir="${OutputDir}/${birt.rcp.zip.name}/features"> 
			<fileset dir="${deposit}/eclipse/features"> <include name="**/*" /> <exclude 
			name="org.eclipse.birt.sdk*/**" /> <exclude name="org.eclipse.birt*source*/**" 
			/> <exclude name="org.eclipse.birt.integration.wtp*/**"/> <exclude name="org.eclipse.birt.thirdparty*/**"/> 
			<exclude name="org.eclipse.birt.rcp*/**"/> <patternset refid="third.party.features"/> 
			</fileset> </copy> <copy todir="${OutputDir}/${birt.rcp.zip.name}"> <fileset 
			dir="${template.dir}/legal"> <include name="**/*" /> <exclude name="eclipse.ini" 
			/> </fileset> </copy> <exec executable="zip" dir="${OutputDir}"> <arg line="-q 
			${OutputDir}/${birt.rcp.zip.name}.zip -r ${birt.rcp.zip.name}" /> </exec> -->


		<!-- Fix bugzilla bug[214678]Adding org.eclipse.birt.report.designer.ui.rcp 
			plugin to the SDK package -->
		<!-- Copy rcp bundles for SDK package -->
		<copy todir="${deposit}/eclipse/plugins">
			<fileset dir="${OutputDir}/${birt.rcp.zip.name}/plugins">
				<include name="org.eclipse.birt.report.designer.ui.rcp*/**" />
				<include name="org.eclipse.birt.report.designer.ui.samples.rcp_*/**" />
			</fileset>
		</copy>


		<delete dir="${OutputDir}/${birt.rcp.zip.name}" />
	</target>

	<target name="createSamplePlugin">
		<!-- Make sample plugin ZIP file -->
		<zip destfile="${OutputDir}/${sample.plugin.zip.name}">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="org.eclipse.birt.sample.reportitem.rotatedtext_*.jar" />
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="eclipse">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
		</zip>
	</target>

	<target name="clean">
		<delete dir="${test.suite.dir}" />
	</target>

	<target name="createWAR">

		<mkdir dir="${runtime.tmp}" />
		<mkdir dir="${war.tmp}/birt" />

		<copy todir="${war.tmp}/birt">
			<fileset
				dir="${deposit}/birt_web/org.eclipse.birt.report.viewer/birt_web">
				<exclude name="WEB-INF/platform/**" />
				<patternset refid="exclude.jars" />
			</fileset>
		</copy>

		<delete file="${war.tmp}/birt/WEB-INF/web.xml" />
		<move file="${war.tmp}/birt/WEB-INF/web_deploy.xml" tofile="${war.tmp}/birt/WEB-INF/web.xml" />

		<!--remove *_jsp.class from the viewservlets.jar in WAR -->
		<unjar src="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar" dest="${war.tmp}/birt/WEB-INF/lib/viewservlets" />
		<delete file="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar" />

		<jar destfile="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar"
			basedir="${war.tmp}/birt/WEB-INF/lib/viewservlets" excludes="**/*_jsp.class" />

		<delete dir="${war.tmp}/birt/WEB-INF/lib/viewservlets" />
		<delete dir="${war.tmp}/birt/ajax" failonerror="false" />

		<zip destfile="${runtime.tmp}/birt.war">
			<zipfileset dir="${war.tmp}/birt">
				<include name="**/*" />
				<exclude name="plugin/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
		</zip>

		<delete dir="${war.tmp}" />
	</target>

	<target name="createWAR_OSGI">
		<mkdir dir="${runtime.tmp}" />
		<mkdir dir="${war.tmp}/birt" />
		<copy todir="${war.tmp}/birt">
			<fileset
				dir="${deposit}/birt_web_OSGI/org.eclipse.birt.report.viewer/birt_web_OSGI">
				<exclude name="plugins/**" />
				<patternset refid="exclude.jars" />
				<exclude name="**/org.eclipse.birt.runtime_*.jar" />
			</fileset>
		</copy>
		<delete file="${war.tmp}/birt/WEB-INF/web.xml" />
		<move file="${war.tmp}/birt/WEB-INF/web_deploy.xml" tofile="${war.tmp}/birt/WEB-INF/web.xml" />

		<!--remove *_jsp.class from the viewservlets.jar in WAR -->
		<unjar src="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar" dest="${war.tmp}/birt/WEB-INF/lib/viewservlets" />
		<delete file="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar" />
		<jar destfile="${war.tmp}/birt/WEB-INF/lib/viewservlets.jar"
			basedir="${war.tmp}/birt/WEB-INF/lib/viewservlets" excludes="**/*_jsp.class" />
		<delete dir="${war.tmp}/birt/WEB-INF/lib/viewservlets" />
		<delete dir="${war.tmp}/birt/ajax" failonerror="false" />
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${war.tmp}/birt/WEB-INF/platform" includes="lib/**" />
		</delete>
		<zip destfile="${runtime.tmp}/birt.war">
			<zipfileset dir="${war.tmp}/birt">
				<include name="**/*" />
				<exclude name="plugin/**" />
				<patternset refid="exclude.jars" />
			</zipfileset>
		</zip>
		<delete dir="${war.tmp}" />
	</target>

	<target name="createDatabase">
		<copy todir="${OutputDir}">
			<fileset dir="${template.dir}/database">
				<include name="*${package.version}*.zip" />
			</fileset>
		</copy>
	</target>

	<target name="createWTPIntegration">

		<zip destfile="${OutputDir}/${wtp.integration.zip.name}">
			<zipfileset dir="${deposit}/eclipse/plugins" prefix="${ZipPrefix}">
				<include name="org.eclipse.birt.integration.wtp.ui_*/**" />
			</zipfileset>
			<zipfileset dir="${deposit}/eclipse/features" prefix="${FeautrePrefix}">
				<include name="org.eclipse.birt.integration.wtp*/*" />
			</zipfileset>
			<zipfileset dir="${template.dir}/legal" prefix="eclipse">
				<include name="**/*" />
				<exclude name="eclipse.ini" />
			</zipfileset>
		</zip>

	</target>

	<target name="createGenReport">
		<echo message="genReportGenerator lib dir: ${OutputDir}/runtime_nonosgi " />
		<echo
			message="genReport.sh/bat output dir: ${template.dir}/engine.runtime.bin" />
		<exec executable="${eclipse.build.configs}/../../extras/genReportGenerator.sh">
			<arg
				line="${buildDirectory}/plugins/org.eclipse.birt.report.viewer/birt_web/WEB-INF/platform/lib" />
			<arg line="${template.dir}/engine.runtime.bin" />
		</exec>
	</target>

	<!--//////////////////////////////////////////////////// -->
	<!--//////////////////////////////////////////////////// -->
	<!--//////////////////////////////////////////////////// -->
	<target name="replace_engine" if="enginefailure">
		<!--replace file="${workingDir}\${birt.info}" token="engineOK=true" value="${enginefailure}"> 
			</replace -->
	</target>
	<target name="replace_model" if="modelfailure">
		<!--replace file="${workingDir}\${birt.info}" token="modelOK=true" value="${modelfailure}"> 
			</replace -->
	</target>
	<target name="replace_designer" if="designerfailure">
		<!--replace file="${workingDir}\${birt.info}" token="designerOK=true" value="${designerfailure}"> 
			</replace -->
	</target>
	<target name="replace_data" if="datafailure">
		<!--replace file="${workingDir}\${birt.info}" token="dataOK=true" value="${datafailure}"> 
			</replace -->
	</target>

	<condition property="build.fromlocal">
		<and>
			<istrue value="${fromlocal}" />
		</and>
	</condition>

</project>
